spring:
  application:
    name: pv-management-backend
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
    open-in-view: false

  cache:
    datasource:
      url: ${CACHE_DATASOURCE_URL:jdbc:postgresql://localhost:5432/homewatts_cache}
      username: ${CACHE_DATASOURCE_USERNAME}
      password: ${CACHE_DATASOURCE_PASSWORD}

  jackson:
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env

logging:
  level:
    root: INFO
    com.pvmanagement: DEBUG
    org.springframework.security: DEBUG
    com.pvmanagement.security: DEBUG

app:
  jwt:
    secret: ${JWT_SECRET}
    access-token-ttl-seconds: ${JWT_TTL_SECONDS:900}
    refresh-token-ttl-seconds: ${JWT_REFRESH_TTL_SECONDS:2592000}
    refresh-token-cookie-secure: ${JWT_REFRESH_COOKIE_SECURE:true}
  demo:
    secret: ${DEMO_SECRET}
    session-max-age-hours: ${DEMO_SESSION_MAX_AGE_HOURS:6}
    default-max-activations: ${DEMO_DEFAULT_MAX_ACTIVATIONS:1000}
    key-valid-days: ${DEMO_KEY_VALID_DAYS:180}

sems:
  base-url: ${SEMS_BASE_URL:https://eu.semsportal.com/api/v2}
  client: ${SEMS_CLIENT:ios}
  version: ${SEMS_VERSION:v2.1.0}
  language: ${SEMS_LANGUAGE:en}
  station-id: ${SEMS_STATION_ID}
  account: ${SEMS_ACCOUNT}
  password: ${SEMS_PASSWORD}
  refresh-interval-ms: ${SEMS_REFRESH_INTERVAL_MS:180000}

resilience4j.retry:
  instances:
    semsSync:
      maxAttempts: 3
      waitDuration: 2s
      enableExponentialBackoff: true
      exponentialBackoffMultiplier: 2.0
      maxWaitDuration: 15s
      randomizedWait: 500ms         # jitter
      retryExceptions:
        - com.pvmanagement.sems.exception.TransientUpstreamException
      ignoreExceptions:
        - com.pvmanagement.sems.exception.AuthorizationExpiredException
        - com.pvmanagement.sems.exception.UpstreamDataMissingException
